{% extends 'neologism_app/base.html' %}

{% block title %}Resultados da Detecção{% endblock %}

{% block content %}
<div class="results">
    <div class="results-header">
        <h3>Resultados da Análise</h3>
        <div class="stats">
            <span>Total de palavras: <strong id="total-words">{{ total_words }}</strong></span>
            <span>Neologismos detectados: <strong id="num-neologisms">{{ num_neologisms }}</strong></span>
        </div>
    </div>
    
    <p class="status-message status-info">Clique nas palavras marcadas no texto para classificá-las ou em "Não é neologismo" na lista abaixo para desmarcá-las.</p>

    <div class="processed-text" id="processed-text-display">
        {{ processed_text_html|safe }}
    </div>

    {% if neologism_candidates %}
    <div class="candidate-list">
        <h3>Candidatos a Neologismos</h3>
        <div id="neologism-candidate-container">
            {% for candidate in neologism_candidates %}
            <div class="candidate-item" data-word-lower="{{ candidate.word_lower }}"> {# Adicionado data-word-lower para fácil seleção #}
                <div class="candidate-info">
                    <span class="candidate-word">{{ candidate.word }}</span>
                    <span class="candidate-pos">({{ candidate.pos|lower }})</span>
                </div>
                <div class="candidate-actions">
                    <button class="btn btn-small btn-secondary classify-btn" 
                            data-word="{{ candidate.word }}" 
                            data-original-pos="{{ candidate.original_pos }}" {# POS original do spaCy #}
                            data-pos="{{ candidate.pos }}" {# POS mapeado para português #}
                            data-lemma="{{ candidate.lemma }}"
                            data-sentence-text="{{ candidate.sentence_text }}">Classificar</button>
                    <button class="btn btn-small btn-reject validate-btn" data-word="{{ candidate.word }}" data-action="reject_neologism">Não é neologismo</button>
                </div>
            </div>
            {% endfor %}
        </div>
        <div style="margin-top: 20px; text-align: center;">
            <a href="{% url 'neologism_app:export_csv' %}" class="btn btn-primary" id="export-csv-btn">Exportar para CSV</a>
        </div>
    </div>
    {% else %}
    <p class="status-message status-complete">Nenhum neologismo detectado neste texto ou todos já foram validados!</p>
    {% endif %}
</div>
{% endblock %}

<!-- Modal de Classificação -->
<div id="neologismModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Classificar Neologismo</h2>
            <button type="button" class="close-button">&times;</button>
        </div>
        <div class="modal-body">
            <div class="modal-field">
                <label>Palavra:</label>
                <strong id="modal-word"></strong>
            </div>
            <div class="modal-field">
                <label>Classe Gramatical Original:</label>
                <span id="modal-original-pos"></span>
            </div>
            <div class="modal-field">
                <label>Lema:</label>
                <span id="modal-lemma"></span>
            </div>
            <div class="modal-field">
                <label for="modal-corrected-pos">Classe Gramatical Correta:</label>
                <select id="modal-corrected-pos">
                    <option value="">Selecione...</option>
                    <option value="Substantivo">Substantivo</option>
                    <option value="Adjetivo">Adjetivo</option>
                    <option value="Verbo">Verbo</option>
                    <option value="Advérbio">Advérbio</option>
                    <option value="Outros">Outros</option>
                </select>
            </div>
            <div class="modal-field">
                <label for="modal-formation-process">Processo de Formação:</label>
                <select id="modal-formation-process">
                    <option value="">Selecione...</option>
                    <option value="derivacao_prefixal">Derivação Prefixal</option>
                    <option value="derivacao_sufixal">Derivação Sufixal</option>
                    <option value="derivacao_parassintética">Derivação Parassintética</option>
                    <option value="composicao">Composição</option>
                    <option value="emprestimo">Empréstimo</option>
                    <option value="outros">Outros</option>
                </select>
            </div>
            <div class="modal-field">
                <label>Contexto da Sentença:</label>
                <p id="modal-sentence-context"></p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" id="modal-save-button" class="btn btn-primary">Salvar Classificação</button>
            <button type="button" class="btn btn-reject modal-reject-btn">Não é neologismo</button>
            <button type="button" class="btn close-button">Cancelar</button>
        </div>
    </div>
</div>

{% block extra_js %}

<script src="{% static 'neologism_app/js/results_scripts.js' %}"></script>

{% endblock %}